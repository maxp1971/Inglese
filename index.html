<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Learn English Pro">
    <title>Learn English - Ultimate Edition</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <style>
        :root {
            --bg-main: linear-gradient(135deg, #fbcfe8, #e9d5ff, #bfdbfe);
            --card-bg: white;
            --text-main: #7e22ce;
            --text-sub: #9333ea;
            --btn-shadow: rgba(0,0,0,0.1);
        }

        .dark-mode {
            --bg-main: linear-gradient(135deg, #1e1b4b, #312e81, #1e1b4b);
            --card-bg: #1e293b;
            --text-main: #e9d5ff;
            --text-sub: #c084fc;
            --btn-shadow: rgba(0,0,0,0.4);
        }

        * { margin: 0; padding: 0; box-sizing: border-box; transition: background 0.3s, color 0.3s; }
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; overflow-x: hidden; -webkit-tap-highlight-color: transparent; background: var(--bg-main); min-height: 100vh; }
        
        .container { padding: 1.5rem; max-width: 600px; margin: 0 auto; }
        
        /* Gradients Categorie */
        .bg-weather { background: linear-gradient(90deg, #38bdf8, #818cf8); }
        .bg-clothes { background: linear-gradient(90deg, #fbbf24, #fb923c); }
        .bg-food { background: linear-gradient(90deg, #f87171, #f472b6); }
        .bg-jobs { background: linear-gradient(90deg, #34d399, #2dd4bf); }
        .bg-numbers { background: linear-gradient(90deg, #a78bfa, #818cf8); }

        .grid-2 { display: grid; grid-template-columns: repeat(2, 1fr); gap: 1rem; }
        .grid-3 { display: grid; grid-template-columns: repeat(3, 1fr); gap: 0.75rem; max-height: 60vh; overflow-y: auto; padding: 10px; }
        
        .btn { border: none; cursor: pointer; transition: transform 0.2s; font-weight: bold; display: flex; flex-direction: column; align-items: center; justify-content: center; }
        .btn:active { transform: scale(0.95); }
        .btn-category { color: white; padding: 1.2rem 1rem; border-radius: 1.2rem; box-shadow: 0 4px 6px var(--btn-shadow); }
        .btn-mode { width: 100%; color: white; font-size: 1.5rem; padding: 1.5rem; border-radius: 1.2rem; margin-bottom: 1rem; }
        .btn-item { background: var(--card-bg); padding: 0.8rem; border-radius: 1rem; box-shadow: 0 4px 6px var(--btn-shadow); min-height: 90px; color: var(--text-main); }
        
        .theme-toggle { position: absolute; top: 1rem; right: 1rem; background: var(--card-bg); border-radius: 50%; padding: 0.5rem; box-shadow: 0 2px 4px var(--btn-shadow); font-size: 1.2rem; }
        
        .writing-input { width: 100%; padding: 1rem; border-radius: 1rem; border: 2px solid #7e22ce; font-size: 1.2rem; text-align: center; margin-top: 1rem; outline: none; background: var(--card-bg); color: var(--text-main); }
        
        .title-main { font-size: 2rem; font-weight: bold; color: var(--text-main); margin-bottom: 0.5rem; margin-top: 1.5rem; }
        .title-sub { font-size: 1rem; color: var(--text-sub); margin-bottom: 1.5rem; }
        
        .stats-card { background: var(--card-bg); border-radius: 1.2rem; padding: 1rem; margin-top: 1.5rem; color: var(--text-main); box-shadow: 0 4px 10px var(--btn-shadow); }
        
        .progress-bar { background: rgba(255, 255, 255, 0.3); border-radius: 99px; height: 6px; width: 100%; margin-top: 8px; }
        .progress-fill { background: white; height: 100%; border-radius: 99px; transition: width 0.5s; }

        .celebration { position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); z-index: 100; font-size: 5rem; animation: pop 0.5s ease-out; }
        @keyframes pop { 0% { transform: translate(-50%, -50%) scale(0); } 100% { transform: translate(-50%, -50%) scale(1); } }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        const App = () => {
            const [isDark, setIsDark] = useState(false);
            const [screen, setScreen] = useState('home');
            const [category, setCategory] = useState(null);
            const [stars, setStars] = useState(() => parseInt(localStorage.getItem('stars')) || 0);
            const [quizMode, setQuizMode] = useState('choice'); // 'choice' or 'writing'
            const [quiz, setQuiz] = useState(null);
            const [userInput, setUserInput] = useState('');
            const [celebration, setCelebration] = useState(null);

            // Generatore numeri 1-100
            const generateNumbers = () => {
                const nums = [];
                const words = ["Zero","One","Two","Three","Four","Five","Six","Seven","Eight","Nine","Ten",
                              "Eleven","Twelve","Thirteen","Fourteen","Fifteen","Sixteen","Seventeen","Eighteen","Nineteen","Twenty"];
                const tens = ["","","Twenty","Thirty","Forty","Fifty","Sixty","Seventy","Eighty","Ninety"];
                
                for(let i=1; i<=100; i++) {
                    let name = "";
                    if(i <= 20) name = words[i];
                    else if(i < 100) {
                        name = tens[Math.floor(i/10)] + (i%10 !== 0 ? "-" + words[i%10] : "");
                    } else name = "One Hundred";
                    nums.push({ name, emoji: i.toString() });
                }
                return nums;
            };

            const data = {
                numbers: { name: 'Numbers 1-100', emoji: 'üî¢', bg: 'bg-numbers', items: generateNumbers() },
                weather: { name: 'Weather', emoji: 'üå§Ô∏è', bg: 'bg-weather', items: [
                    {name:'Sun',emoji:'‚òÄÔ∏è'},{name:'Rain',emoji:'üåßÔ∏è'},{name:'Cloud',emoji:'‚òÅÔ∏è'},
                    {name:'Snow',emoji:'‚ùÑÔ∏è'},{name:'Wind',emoji:'üí®'},{name:'Storm',emoji:'‚ö°'}
                ]},
                clothes: { name: 'Clothes', emoji: 'üëï', bg: 'bg-clothes', items: [
                    {name:'Shirt',emoji:'üëï'},{name:'Pants',emoji:'üëñ'},{name:'Shoes',emoji:'üëü'},
                    {name:'Hat',emoji:'üß¢'},{name:'Dress',emoji:'üëó'},{name:'Coat',emoji:'üß•'}
                ]},
                food: { name: 'Food', emoji: 'üçï', bg: 'bg-food', items: [
                    {name:'Pizza',emoji:'üçï'},{name:'Bread',emoji:'üçû'},{name:'Milk',emoji:'ü•õ'},
                    {name:'Apple',emoji:'üçé'},{name:'Egg',emoji:'ü•ö'},{name:'Cake',emoji:'üç∞'}
                ]},
                jobs: { name: 'Jobs', emoji: 'üë®‚Äç‚öïÔ∏è', bg: 'bg-jobs', items: [
                    {name:'Doctor',emoji:'üë®‚Äç‚öïÔ∏è'},{name:'Teacher',emoji:'üë©‚Äçüè´'},{name:'Police',emoji:'üëÆ'},
                    {name:'Chef',emoji:'üë®‚Äçüç≥'},{name:'Artist',emoji:'üé®'},{name:'Pilot',emoji:'üë®‚Äç‚úàÔ∏è'}
                ]},
                animals: { name: 'Animals', emoji: 'üêæ', bg: 'bg-numbers', items: [
                    {name:'Cat',emoji:'üê±'},{name:'Dog',emoji:'üê∂'},{name:'Lion',emoji:'ü¶Å'},{name:'Elephant',emoji:'üêò'}
                ]}
            };

            useEffect(() => { localStorage.setItem('stars', stars); }, [stars]);

            const playSound = (type) => {
                const ctx = new (window.AudioContext || window.webkitAudioContext)();
                const osc = ctx.createOscillator();
                const gain = ctx.createGain();
                osc.connect(gain);
                gain.connect(ctx.destination);
                
                if(type === 'correct') {
                    osc.frequency.setValueAtTime(523.25, ctx.currentTime); // C5
                    osc.frequency.exponentialRampToValueAtTime(880, ctx.currentTime + 0.1);
                    gain.gain.fadeOutAtTime = 0.5;
                } else {
                    osc.frequency.setValueAtTime(150, ctx.currentTime);
                    osc.frequency.exponentialRampToValueAtTime(100, ctx.currentTime + 0.2);
                }
                
                osc.start();
                osc.stop(ctx.currentTime + 0.2);
            };

            const speak = (text) => {
                window.speechSynthesis.cancel();
                const u = new SpeechSynthesisUtterance(text);
                u.lang = 'en-US';
                window.speechSynthesis.speak(u);
            };

            const startQuiz = (mode) => {
                setQuizMode(mode);
                const items = data[category].items;
                const correct = items[Math.floor(Math.random() * items.length)];
                const options = [correct, ...items.filter(i => i.name !== correct.name).sort(() => 0.5 - Math.random()).slice(0, 3)].sort(() => 0.5 - Math.random());
                setQuiz({ correct, options });
                setUserInput('');
                setScreen('quiz');
                speak(`Find ${correct.name}`);
            };

            const checkAnswer = (answer) => {
                if(answer.toLowerCase().trim() === quiz.correct.name.toLowerCase()) {
                    setStars(s => s + 5);
                    setCelebration('‚≠ê');
                    playSound('correct');
                    setTimeout(() => { setCelebration(null); startQuiz(quizMode); }, 1000);
                } else {
                    playSound('wrong');
                }
            };

            return (
                <div className={`container ${isDark ? 'dark-mode' : ''}`}>
                    <button className="theme-toggle" onClick={() => setIsDark(!isDark)}>{isDark ? '‚òÄÔ∏è' : 'üåô'}</button>

                    {screen === 'home' && (
                        <div className="text-center">
                            <h1 className="title-main">English Fun Pro üöÄ</h1>
                            <p className="title-sub">Impara e gioca!</p>
                            <div className="grid-2">
                                {Object.keys(data).map(k => (
                                    <button key={k} className={`btn btn-category ${data[k].bg}`} onClick={() => {setCategory(k); setScreen('mode');}}>
                                        <span style={{fontSize:'2rem'}}>{data[k].emoji}</span>
                                        <span>{data[k].name}</span>
                                    </button>
                                ))}
                            </div>
                            <div className="stats-card">
                                <h2>Punteggio: ‚≠ê {stars}</h2>
                            </div>
                        </div>
                    )}

                    {screen === 'mode' && (
                        <div className="text-center">
                            <button className="btn" style={{color: 'var(--text-main)'}} onClick={() => setScreen('home')}>‚¨ÖÔ∏è Home</button>
                            <h2 className="title-main">{data[category].name}</h2>
                            <button className="btn btn-mode bg-weather" onClick={() => setScreen('learn')}>üìö Learn</button>
                            <button className="btn btn-mode bg-food" onClick={() => startQuiz('choice')}>üéÆ Quiz (Easy)</button>
                            <button className="btn btn-mode bg-jobs" onClick={() => startQuiz('writing')}>‚úçÔ∏è Writing (Hard)</button>
                        </div>
                    )}

                    {screen === 'learn' && (
                        <div>
                            <button className="btn" style={{color: 'var(--text-main)'}} onClick={() => setScreen('mode')}>‚¨ÖÔ∏è Back</button>
                            <div className="grid-3">
                                {data[category].items.map((item, i) => (
                                    <button key={i} className="btn btn-item" onClick={() => speak(item.name)}>
                                        <span style={{fontSize:'2rem'}}>{item.emoji}</span>
                                        <span style={{fontSize:'0.8rem'}}>{item.name}</span>
                                    </button>
                                ))}
                            </div>
                        </div>
                    )}

                    {screen === 'quiz' && quiz && (
                        <div className="text-center">
                            <button className="btn" style={{color: 'var(--text-main)'}} onClick={() => setScreen('mode')}>‚¨ÖÔ∏è Esci</button>
                            <h2 style={{fontSize:'3rem', color: 'var(--text-main)', margin:'1rem 0'}}>{quiz.correct.emoji}</h2>
                            
                            {quizMode === 'choice' ? (
                                <div className="grid-2">
                                    {quiz.options.map((opt, i) => (
                                        <button key={i} className="btn btn-item" style={{fontSize:'1.2rem'}} onClick={() => checkAnswer(opt.name)}>
                                            {opt.name}
                                        </button>
                                    ))}
                                </div>
                            ) : (
                                <div>
                                    <p style={{color: 'var(--text-main)'}}>Scrivi il nome in inglese:</p>
                                    <input 
                                        className="writing-input"
                                        autoFocus
                                        value={userInput}
                                        onChange={(e) => setUserInput(e.target.value)}
                                        onKeyDown={(e) => e.key === 'Enter' && checkAnswer(userInput)}
                                    />
                                    <button className="btn btn-mode bg-jobs" style={{marginTop:'1rem'}} onClick={() => checkAnswer(userInput)}>Invia</button>
                                </div>
                            )}
                            <button className="btn" style={{marginTop:'1rem', color:'#3b82f6'}} onClick={() => speak(quiz.correct.name)}>üîä Suggerimento</button>
                        </div>
                    )}

                    {celebration && <div className="celebration">{celebration}</div>}
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
